{
  "annotations": { "list": [] },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "panels": [
    {
      "title": "Retrieval Health",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "collapsed": false
    },
    {
      "title": "Query Rate (queries/sec)",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 1 },
      "targets": [
        {
          "expr": "rate(qortex_queries_total[5m])",
          "legendFormat": "{{mode}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "reqps"
        }
      }
    },
    {
      "title": "Query Latency (p50/p95/p99)",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 1 },
      "targets": [
        {
          "expr": "histogram_quantile(0.50, rate(qortex_query_duration_seconds_bucket[5m]))",
          "legendFormat": "p50"
        },
        {
          "expr": "histogram_quantile(0.95, rate(qortex_query_duration_seconds_bucket[5m]))",
          "legendFormat": "p95"
        },
        {
          "expr": "histogram_quantile(0.99, rate(qortex_query_duration_seconds_bucket[5m]))",
          "legendFormat": "p99"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s"
        }
      }
    },
    {
      "title": "Vec Search Latency (p50/p95)",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 9 },
      "targets": [
        {
          "expr": "histogram_quantile(0.50, rate(qortex_vec_search_duration_seconds_bucket[5m]))",
          "legendFormat": "p50"
        },
        {
          "expr": "histogram_quantile(0.95, rate(qortex_vec_search_duration_seconds_bucket[5m]))",
          "legendFormat": "p95"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s"
        }
      }
    },
    {
      "title": "Query Errors",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 9 },
      "targets": [
        {
          "expr": "rate(qortex_query_errors_total[5m])",
          "legendFormat": "{{stage}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "cps"
        }
      }
    },
    {
      "title": "Learning Dynamics",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 17 },
      "collapsed": false
    },
    {
      "title": "Factor Mean Over Time",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 18 },
      "targets": [
        {
          "expr": "qortex_factor_mean",
          "legendFormat": "mean factor"
        }
      ]
    },
    {
      "title": "Factor Entropy",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 18 },
      "targets": [
        {
          "expr": "qortex_factor_entropy",
          "legendFormat": "entropy"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "bits"
        }
      }
    },
    {
      "title": "Factor Update Rate",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 18 },
      "targets": [
        {
          "expr": "rate(qortex_factor_updates_total[5m])",
          "legendFormat": "{{outcome}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "cps"
        }
      }
    },
    {
      "title": "Feedback Accept/Reject Ratio",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 26 },
      "targets": [
        {
          "expr": "rate(qortex_feedback_total{outcome=\"accepted\"}[5m])",
          "legendFormat": "accepted"
        },
        {
          "expr": "rate(qortex_feedback_total{outcome=\"rejected\"}[5m])",
          "legendFormat": "rejected"
        }
      ]
    },
    {
      "title": "KG Crystallization",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 34 },
      "collapsed": false
    },
    {
      "title": "KG Coverage Ratio",
      "type": "gauge",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 35 },
      "targets": [
        {
          "expr": "qortex_kg_coverage",
          "legendFormat": "coverage"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "min": 0,
          "max": 1,
          "unit": "percentunit",
          "thresholds": {
            "steps": [
              { "color": "red", "value": null },
              { "color": "yellow", "value": 0.3 },
              { "color": "green", "value": 0.7 }
            ]
          }
        }
      }
    },
    {
      "title": "Buffer Size & Promotions",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 35 },
      "targets": [
        {
          "expr": "qortex_buffer_edges",
          "legendFormat": "buffered"
        },
        {
          "expr": "rate(qortex_edges_promoted_total[1h])",
          "legendFormat": "promotions/hr"
        }
      ]
    },
    {
      "title": "Total Promoted (lifetime)",
      "type": "stat",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 35 },
      "targets": [
        {
          "expr": "qortex_edges_promoted_total",
          "legendFormat": "total promoted"
        }
      ]
    },
    {
      "title": "PPR Performance",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 43 },
      "collapsed": false
    },
    {
      "title": "PPR Executions / sec",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 44 },
      "targets": [
        {
          "expr": "rate(qortex_ppr_started_total[5m])",
          "legendFormat": "PPR runs/sec"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "cps"
        }
      }
    },
    {
      "title": "PPR Iterations to Convergence",
      "type": "histogram",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 44 },
      "targets": [
        {
          "expr": "rate(qortex_ppr_iterations_bucket[5m])",
          "legendFormat": "{{le}}"
        }
      ]
    },
    {
      "title": "Active Factors & Node Count",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 44 },
      "targets": [
        {
          "expr": "qortex_factors_active",
          "legendFormat": "active factors"
        }
      ]
    },
    {
      "title": "Online Edge Generation",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 52 },
      "targets": [
        {
          "expr": "qortex_online_edge_count",
          "legendFormat": "edges / query"
        },
        {
          "expr": "rate(qortex_online_edges_generated_total[5m])",
          "legendFormat": "generation events / sec"
        }
      ]
    },
    {
      "title": "KG Coverage Over Time",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 52 },
      "targets": [
        {
          "expr": "qortex_kg_coverage",
          "legendFormat": "coverage"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "min": 0,
          "max": 1,
          "unit": "percentunit"
        }
      }
    },
    {
      "title": "Enrichment & Ingestion",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 60 },
      "collapsed": false
    },
    {
      "title": "Enrichment Rate",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 61 },
      "targets": [
        {
          "expr": "rate(qortex_enrichment_total[5m])",
          "legendFormat": "{{backend_type}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "cps"
        }
      }
    },
    {
      "title": "Enrichment Latency (p50/p95)",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 61 },
      "targets": [
        {
          "expr": "histogram_quantile(0.50, rate(qortex_enrichment_duration_seconds_bucket[5m]))",
          "legendFormat": "p50"
        },
        {
          "expr": "histogram_quantile(0.95, rate(qortex_enrichment_duration_seconds_bucket[5m]))",
          "legendFormat": "p95"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s"
        }
      }
    },
    {
      "title": "Enrichment Fallbacks",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 61 },
      "targets": [
        {
          "expr": "rate(qortex_enrichment_fallbacks_total[5m])",
          "legendFormat": "fallbacks/sec"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "cps"
        }
      }
    },
    {
      "title": "Ingestion Rate",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 69 },
      "targets": [
        {
          "expr": "rate(qortex_manifests_ingested_total[5m])",
          "legendFormat": "{{domain}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "cps"
        }
      }
    },
    {
      "title": "Ingest Latency (p50/p95)",
      "type": "timeseries",
      "datasource": { "type": "prometheus", "uid": "${DS_PROMETHEUS}" },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 69 },
      "targets": [
        {
          "expr": "histogram_quantile(0.50, rate(qortex_ingest_duration_seconds_bucket[5m]))",
          "legendFormat": "p50"
        },
        {
          "expr": "histogram_quantile(0.95, rate(qortex_ingest_duration_seconds_bucket[5m]))",
          "legendFormat": "p95"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s"
        }
      }
    }
  ],
  "schemaVersion": 39,
  "tags": ["qortex", "observability"],
  "templating": {
    "list": [
      {
        "name": "DS_PROMETHEUS",
        "type": "datasource",
        "query": "prometheus",
        "current": { "text": "Prometheus", "value": "Prometheus" },
        "hide": 2
      }
    ]
  },
  "time": { "from": "now-1h", "to": "now" },
  "timepicker": {},
  "timezone": "",
  "title": "qortex Observability",
  "uid": "qortex-main",
  "version": 1
}
